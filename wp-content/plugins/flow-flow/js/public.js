window.CustomModernizr=function(a,b,c){function d(a){s.cssText=a}function e(a,b){return typeof a===b}function f(a,b){return!!~(""+a).indexOf(b)}function g(a,b){for(var d in a){var e=a[d];if(!f(e,"-")&&s[e]!==c)return"pfx"==b?e:!0}return!1}function h(a,b,d){for(var f in a){var g=b[a[f]];if(g!==c)return d===!1?a[f]:e(g,"function")?g.bind(d||b):g}return!1}function i(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),f=(a+" "+v.join(d+" ")+d).split(" ");return e(b,"string")||e(b,"undefined")?g(f,b):(f=(a+" "+w.join(d+" ")+d).split(" "),h(f,b,c))}var j,k,l,m="2.6.2",n={},o=!0,p=b.documentElement,q="modernizr",r=b.createElement(q),s=r.style,t=({}.toString," -webkit- -moz- -o- -ms- ".split(" ")),u="Webkit Moz O ms",v=u.split(" "),w=u.toLowerCase().split(" "),x={},y=[],z=y.slice,A=function(a,c,d,e){var f,g,h,i,j=b.createElement("div"),k=b.body,l=k||b.createElement("body");if(parseInt(d,10))for(;d--;)h=b.createElement("div"),h.id=e?e[d]:q+(d+1),j.appendChild(h);return f=["&#173;",'<style id="s',q,'">',a,"</style>"].join(""),j.id=q,(k?j:l).innerHTML+=f,l.appendChild(j),k||(l.style.background="",l.style.overflow="hidden",i=p.style.overflow,p.style.overflow="hidden",p.appendChild(l)),g=c(j,a),k?j.parentNode.removeChild(j):(l.parentNode.removeChild(l),p.style.overflow=i),!!g},B={}.hasOwnProperty;l=e(B,"undefined")||e(B.call,"undefined")?function(a,b){return b in a&&e(a.constructor.prototype[b],"undefined")}:function(a,b){return B.call(a,b)},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;var c=z.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(z.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(z.call(arguments)))};return d}),x.csstransforms=function(){return!!i("transform")},x.csstransforms3d=function(){var a=!!i("perspective");return a&&"webkitPerspective"in p.style&&A("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b,c){a=9===b.offsetLeft&&3===b.offsetHeight}),a},x.csstransitions=function(){return i("transition")};for(var C in x)l(x,C)&&(k=C.toLowerCase(),n[k]=x[C](),y.push((n[k]?"":"no-")+k));return n.addTest=function(a,b){if("object"==typeof a)for(var d in a)l(a,d)&&n.addTest(d,a[d]);else{if(a=a.toLowerCase(),n[a]!==c)return n;b="function"==typeof b?b():b,"undefined"!=typeof o&&o&&(p.className+=" "+(b?"":"no-")+a),n[a]=b}return n},d(""),r=j=null,n._version=m,n._prefixes=t,n._domPrefixes=w,n._cssomPrefixes=v,n.testProp=function(a){return g([a])},n.testAllProps=i,n.testStyles=A,n.prefixed=function(a,b,c){return b?i(a,b,c):i(a,"pfx")},p.className=p.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(o?" js "+y.join(" "):""),n}(this,this.document),window.findAndReplaceDOMText=function(){function a(a){return String(a).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function b(){return c.apply(null,arguments)||d.apply(null,arguments)}function c(a,c,e,f,g){if(c&&!c.nodeType&&arguments.length<=2)return!1;var h="function"==typeof e;h&&(e=function(a){return function(b,c){return a(b.text,c.startIndex)}}(e));var i=d(c,{find:a,wrap:h?null:e,replace:h?e:"$"+(f||"&"),prepMatch:function(a,b){if(!a[0])throw"findAndReplaceDOMText cannot handle zero-length matches";if(f>0){var c=a[f];a.index+=a[0].indexOf(c),a[0]=c}return a.endIndex=a.index+a[0].length,a.startIndex=a.index,a.index=b,a},filterElements:g});return b.revert=function(){return i.revert()},!0}function d(a,b){return new e(a,b)}function e(a,b){b.portionMode=b.portionMode||f,this.node=a,this.options=b,this.prepMatch=b.prepMatch||this.prepMatch,this.reverts=[],this.matches=this.search(),this.matches.length&&this.processMatches()}var f="retain",g="first",h=document;({}).toString;return b.Finder=e,e.prototype={search:function(){var b,c=0,d=this.options.find,e=this.getAggregateText(),f=[];if(d="string"==typeof d?RegExp(a(d),"g"):d,d.global)for(;b=d.exec(e);)f.push(this.prepMatch(b,c++));else(b=e.match(d))&&f.push(this.prepMatch(b,0));return f},prepMatch:function(a,b){if(!a[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");return a.endIndex=a.index+a[0].length,a.startIndex=a.index,a.index=b,a},getAggregateText:function(){function a(c){if(3===c.nodeType)return c.data;if(b&&!b(c))return"";var d="";if(c=c.firstChild)do d+=a(c);while(c=c.nextSibling);return d}var b=this.options.filterElements;return a(this.node)},processMatches:function(){var a,b,c,d=this.matches,e=this.node,f=this.options.filterElements,g=[],h=e,i=d.shift(),j=0,k=0,l=0,m=[e];a:for(;;){if(3===h.nodeType&&(!b&&h.length+j>=i.endIndex?b={node:h,index:l++,text:h.data.substring(i.startIndex-j,i.endIndex-j),indexInMatch:j-i.startIndex,indexInNode:i.startIndex-j,endIndexInNode:i.endIndex-j,isEnd:!0}:a&&g.push({node:h,index:l++,text:h.data,indexInMatch:j-i.startIndex,indexInNode:0}),!a&&h.length+j>i.startIndex&&(a={node:h,index:l++,indexInMatch:0,indexInNode:i.startIndex-j,endIndexInNode:i.endIndex-j,text:h.data.substring(i.startIndex-j,i.endIndex-j)}),j+=h.data.length),c=1===h.nodeType&&f&&!f(h),a&&b){if(h=this.replaceMatch(i,a,g,b),j-=b.node.data.length-b.endIndexInNode,a=null,b=null,g=[],i=d.shift(),l=0,k++,!i)break}else if(!c&&(h.firstChild||h.nextSibling)){h.firstChild?(m.push(h),h=h.firstChild):h=h.nextSibling;continue}for(;;){if(h.nextSibling){h=h.nextSibling;break}if(h=m.pop(),h===e)break a}}},revert:function(){for(var a=this.reverts.length;a--;)this.reverts[a]();this.reverts=[]},prepareReplacementString:function(a,b,c,d){var e=this.options.portionMode;return e===g&&b.indexInMatch>0?"":(a=a.replace(/\$(\d+|&|`|')/g,function(a,b){var d;switch(b){case"&":d=c[0];break;case"`":d=c.input.substring(0,c.startIndex);break;case"'":d=c.input.substring(c.endIndex);break;default:d=c[+b]}return d}),e===g?a:b.isEnd?a.substring(b.indexInMatch):a.substring(b.indexInMatch,b.indexInMatch+b.text.length))},getPortionReplacementNode:function(a,b,c){var d=this.options.replace||"$&",e=this.options.clss,f=this.options.wrap;if(f&&f.nodeType){var g=h.createElement("div");g.innerHTML=f.outerHTML||(new XMLSerializer).serializeToString(f),f=g.firstChild}if("function"==typeof d)return d=d(a,b,c),d&&d.nodeType?d:h.createTextNode(String(d));var i="string"==typeof f?h.createElement(f):f;return e&&(i.className=e),d=h.createTextNode(this.prepareReplacementString(d,a,b,c)),d.data&&i?(i.appendChild(d),i):d},replaceMatch:function(a,b,c,d){var e,f,g=b.node,i=d.node;if(g===i){var j=g;b.indexInNode>0&&(e=h.createTextNode(j.data.substring(0,b.indexInNode)),j.parentNode.insertBefore(e,j));var k=this.getPortionReplacementNode(d,a);return j.parentNode.insertBefore(k,j),d.endIndexInNode<j.length&&(f=h.createTextNode(j.data.substring(d.endIndexInNode)),j.parentNode.insertBefore(f,j)),j.parentNode.removeChild(j),this.reverts.push(function(){e===k.previousSibling&&e.parentNode.removeChild(e),f===k.nextSibling&&f.parentNode.removeChild(f),k.parentNode.replaceChild(j,k)}),k}e=h.createTextNode(g.data.substring(0,b.indexInNode)),f=h.createTextNode(i.data.substring(d.endIndexInNode));for(var l=this.getPortionReplacementNode(b,a),m=[],n=0,o=c.length;o>n;++n){var p=c[n],q=this.getPortionReplacementNode(p,a);p.node.parentNode.replaceChild(q,p.node),this.reverts.push(function(a,b){return function(){b.parentNode.replaceChild(a.node,b)}}(p,q)),m.push(q)}var r=this.getPortionReplacementNode(d,a);return g.parentNode.insertBefore(e,g),g.parentNode.insertBefore(l,g),g.parentNode.removeChild(g),i.parentNode.insertBefore(r,i),i.parentNode.insertBefore(f,i),i.parentNode.removeChild(i),this.reverts.push(function(){e.parentNode.removeChild(e),l.parentNode.replaceChild(g,l),f.parentNode.removeChild(f),r.parentNode.replaceChild(i,r)}),r}},b}(),!function(a,b){function c(a,b,c){var d=a.children(),e=!1;a.empty();for(var g=0,h=d.length;h>g;g++){var i=d.eq(g);if(a.append(i),c&&a.append(c),f(a,b)){i.remove(),e=!0;break}c&&c.detach()}return e}function d(b,c,g,h,i){var j=!1,k="a, table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, blockquote, select, optgroup, option, textarea, script, style",l="script, .dotdotdot-keep";return b.contents().detach().each(function(){var m=this,n=a(m);if("undefined"==typeof m)return!0;if(n.is(l))b.append(n);else{if(j)return!0;b.append(n),!i||n.is(h.after)||n.find(h.after).length||b[b.is(k)?"after":"append"](i),f(g,h)&&(j=3==m.nodeType?e(n,c,g,h,i):d(n,c,g,h,i)),j||i&&i.detach()}}),c.addClass("is-truncated"),j}function e(b,c,d,e,h){var k=b[0];if(!k)return!1;var m=j(k),n=-1!==m.indexOf(" ")?" ":"　",o="letter"==e.wrap?"":n,p=m.split(o),q=-1,r=-1,s=0,t=p.length-1;for(e.fallbackToLetter&&0==s&&0==t&&(o="",p=m.split(o),t=p.length-1);t>=s&&(0!=s||0!=t);){var u=Math.floor((s+t)/2);if(u==r)break;r=u,i(k,p.slice(0,r+1).join(o)+e.ellipsis),d.children().each(function(){a(this).toggle().toggle()}),f(d,e)?(t=r,e.fallbackToLetter&&0==s&&0==t&&(o="",p=p[0].split(o),q=-1,r=-1,s=0,t=p.length-1)):(q=r,s=r)}if(-1==q||1==p.length&&0==p[0].length){var v=b.parent();b.detach();var w=h&&h.closest(v).length?h.length:0;if(v.contents().length>w?k=l(v.contents().eq(-1-w),c):(k=l(v,c,!0),w||v.detach()),k&&(m=g(j(k),e),i(k,m),w&&h)){var x=h.parent();a(k).parent().append(h),a.trim(x.html())||x.remove()}}else m=g(p.slice(0,q+1).join(o),e),i(k,m);return!0}function f(a,b){return a.innerHeight()>b.maxHeight}function g(b,c){for(;a.inArray(b.slice(-1),c.lastCharacter.remove)>-1;)b=b.slice(0,-1);return a.inArray(b.slice(-1),c.lastCharacter.noEllipsis)<0&&(b+=c.ellipsis),b}function h(a){return{width:a.innerWidth(),height:a.innerHeight()}}function i(a,b){a.innerText?a.innerText=b:a.nodeValue?a.nodeValue=b:a.textContent&&(a.textContent=b)}function j(a){return a.innerText?a.innerText:a.nodeValue?a.nodeValue:a.textContent?a.textContent:""}function k(a){do a=a.previousSibling;while(a&&1!==a.nodeType&&3!==a.nodeType);return a}function l(b,c,d){var e,f=b&&b[0];if(f){if(!d){if(3===f.nodeType)return f;if(a.trim(b.text()))return l(b.contents().last(),c)}for(e=k(f);!e;){if(b=b.parent(),b.is(c)||!b.length)return!1;e=k(b[0])}if(e)return l(a(e),c)}return!1}function m(b,c){return b?"string"==typeof b?(b=a(b,c),b.length?b:!1):b.jquery?b:!1:!1}function n(a){for(var b=a.innerHeight(),c=["paddingTop","paddingBottom"],d=0,e=c.length;e>d;d++){var f=parseInt(a.css(c[d]),10);isNaN(f)&&(f=0),b-=f}return b}if(!a.fn.dotdotdot){a.fn.dotdotdot=function(b){if(0==this.length)return a.fn.dotdotdot.debug('No element found for "'+this.selector+'".'),this;if(this.length>1)return this.each(function(){a(this).dotdotdot(b)});var e=this,g=e.contents();e.data("dotdotdot")&&e.trigger("destroy.dot"),e.data("dotdotdot-style",e.attr("style")||""),e.css("word-wrap","break-word"),"nowrap"===e.css("white-space")&&e.css("white-space","normal"),e.bind_events=function(){return e.bind("update.dot",function(b,h){switch(e.removeClass("is-truncated"),b.preventDefault(),b.stopPropagation(),typeof i.height){case"number":i.maxHeight=i.height;break;case"function":i.maxHeight=i.height.call(e[0]);break;default:i.maxHeight=n(e)}i.maxHeight+=i.tolerance,"undefined"!=typeof h&&(("string"==typeof h||"nodeType"in h&&1===h.nodeType)&&(h=a("<div />").append(h).contents()),h instanceof a&&(g=h)),p=e.wrapInner('<div class="dotdotdot" />').children(),p.contents().detach().end().append(g.clone(!0)).find("br").replaceWith("  <br />  ").end().css({height:"auto",width:"auto",border:"none",padding:0,margin:0});var k=!1,l=!1;return j.afterElement&&(k=j.afterElement.clone(!0),k.show(),j.afterElement.detach()),f(p,i)&&(l="children"==i.wrap?c(p,i,k):d(p,e,p,i,k)),p.replaceWith(p.contents()),p=null,a.isFunction(i.callback)&&i.callback.call(e[0],l,g),j.isTruncated=l,l}).bind("isTruncated.dot",function(a,b){return a.preventDefault(),a.stopPropagation(),"function"==typeof b&&b.call(e[0],j.isTruncated),j.isTruncated}).bind("originalContent.dot",function(a,b){return a.preventDefault(),a.stopPropagation(),"function"==typeof b&&b.call(e[0],g),g}).bind("destroy.dot",function(a){a.preventDefault(),a.stopPropagation(),e.unwatch().unbind_events().contents().detach().end().append(g).attr("style",e.data("dotdotdot-style")||"").removeClass("is-truncated").data("dotdotdot",!1)}),e},e.unbind_events=function(){return e.unbind(".dot"),e},e.watch=function(){if(e.unwatch(),"window"==i.watch){var b=a(window),c=b.width(),d=b.height();b.bind("resize.dot"+j.dotId,function(){c==b.width()&&d==b.height()&&i.windowResizeFix||(c=b.width(),d=b.height(),l&&clearInterval(l),l=setTimeout(function(){e.trigger("update.dot")},100))})}else k=h(e),l=setInterval(function(){if(e.is(":visible")){var a=h(e);k.width==a.width&&k.height==a.height||(e.trigger("update.dot"),k=a)}},500);return e},e.unwatch=function(){return a(window).unbind("resize.dot"+j.dotId),l&&clearInterval(l),e};var i=a.extend(!0,{},a.fn.dotdotdot.defaults,b),j={},k={},l=null,p=null;return i.lastCharacter.remove instanceof Array||(i.lastCharacter.remove=a.fn.dotdotdot.defaultArrays.lastCharacter.remove),i.lastCharacter.noEllipsis instanceof Array||(i.lastCharacter.noEllipsis=a.fn.dotdotdot.defaultArrays.lastCharacter.noEllipsis),j.afterElement=m(i.after,e),j.isTruncated=!1,j.dotId=o++,e.data("dotdotdot",!0).bind_events().trigger("update.dot"),i.watch&&e.watch(),e},a.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",fallbackToLetter:!0,lastCharacter:{},tolerance:0,callback:null,after:null,height:null,watch:!1,windowResizeFix:!0},a.fn.dotdotdot.defaultArrays={lastCharacter:{remove:[" ","　",",",";",".","!","?"],noEllipsis:[]}},a.fn.dotdotdot.debug=function(a){};var o=1,p=a.fn.html;a.fn.html=function(c){return c!=b&&!a.isFunction(c)&&this.data("dotdotdot")?this.trigger("update",[c]):p.apply(this,arguments)};var q=a.fn.text;a.fn.text=function(c){return c!=b&&!a.isFunction(c)&&this.data("dotdotdot")?(c=a("<div />").text(c).html(),this.trigger("update",[c])):q.apply(this,arguments)}}}(jQuery),jQuery(document).ready(function(a){a(".dot-ellipsis").each(function(){var b=a(this).hasClass("dot-resize-update"),c=a(this).hasClass("dot-timer-update"),d=0,e=a(this).attr("class").split(/\s+/);a.each(e,function(a,b){var c=b.match(/^dot-height-(\d+)$/);null!==c&&(d=Number(c[1]))});var f=new Object;c&&(f.watch=!0),b&&(f.watch="window"),d>0&&(f.height=d),a(this).dotdotdot(f)})}),jQuery(window).on("load",function(){jQuery(".dot-ellipsis.dot-load-update").trigger("update.dot")}),function(a){window.ShuffleCustom=a(window.jQuery,window.CustomModernizr)}(function(a,b,c){"use strict";function d(a){return a?a.replace(/([A-Z])/g,function(a,b){return"-"+b.toLowerCase()}).replace(/^ms-/,"-ms-"):""}function e(b,c,d){var e,f,g,h=null,i=0;d=d||{};var j=function(){i=d.leading===!1?0:a.now(),h=null,g=b.apply(e,f),e=f=null};return function(){var k=a.now();i||d.leading!==!1||(i=k);var l=c-(k-i);return e=this,f=arguments,0>=l||l>c?(clearTimeout(h),h=null,i=k,g=b.apply(e,f),e=f=null):h||d.trailing===!1||(h=setTimeout(j,l)),g}}function f(a,b,c){for(var d=0,e=a.length;e>d;d++)if(b.call(c,a[d],d,a)==={})return}function g(b,c,d){return setTimeout(a.proxy(b,c),d)}function h(a){return Math.max.apply(Math,a)}function i(a){return Math.min.apply(Math,a)}function j(b){return a.isNumeric(b)?b:0}function k(a){var b,c,d=a.length;if(!d)return a;for(;--d;)c=Math.floor(Math.random()*(d+1)),b=a[c],a[c]=a[d],a[d]=b;return a}if("object"!=typeof b)throw new Error("Shuffle.js requires Modernizr.\nhttp://vestride.github.io/Shuffle/#dependencies");var l=b.prefixed("transition"),m=b.prefixed("transitionDelay"),n=b.prefixed("transitionDuration"),o={WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[l],p=b.prefixed("transform"),q=d(p),r=b.csstransforms&&b.csstransitions,s=b.csstransforms3d,t="shuffle",u=.3,v="all",w="groups",x=1,y=.001,z=function(a,b){this.x=j(a),this.y=j(b)};z.equals=function(a,b){return a.x===b.x&&a.y===b.y};var A=0,B=a(window),C=0,D=function(b,c,d){c=c||{},a.extend(this,D.options,c,D.settings),this.$el=a(b),this.id=C++,this.element=b,this.only_sort=d,this.unique="shuffle_"+A++,this._fire(D.EventType.LOADING),this._init(),g(function(){this.initialized=!0,this._fire(D.EventType.DONE)},this,16)};return D.EventType={LOADING:"loading",DONE:"done",LAYOUT:"layout",REMOVED:"removed"},D.ClassName={BASE:t,SHUFFLE_ITEM:"shuffle-item",FILTERED:"filtered",CONCEALED:"concealed"},D.options={group:v,speed:250,easing:"ease-out",itemSelector:"",sizer:null,gutterWidth:0,columnWidth:0,delimeter:null,buffer:0,initialSort:null,throttle:e,throttleTime:100,sequentialFadeDelay:150,supported:r},D.settings={useSizer:!1,itemCss:{position:"absolute",top:0,left:0,visibility:"visible"},revealAppendedDelay:300,lastSort:{},lastFilter:v,enabled:!0,destroyed:!1,initialized:!1,_animations:[],styleQueue:[]},D.Point=z,D._getItemTransformString=function(a,b){return s?"translate3d("+a.x+"px, "+a.y+"px, 0) scale3d("+b+", "+b+", 1)":"translate("+a.x+"px, "+a.y+"px) scale("+b+")"},D._getNumberStyle=function(b,c){return D._getFloat(a(b).css(c))},D._getInt=function(a){return j(parseInt(a,10))},D._getFloat=function(a){return j(parseFloat(a))},D._getOuterWidth=function(b,c){return a(b).outerWidth(!!c)},D._getOuterHeight=function(b,c){return a(b).outerHeight(!!c)},D._skipTransition=function(a,b,c){var d=a.style[n];a.style[n]="0ms",b.call(c);var e=a.offsetWidth;e=null,a.style[n]=d},D.prototype._init=function(){if(this.$items=this._getItems(),!this.only_sort){this.sizer=this._getElementOption(this.sizer),this.sizer&&(this.useSizer=!0),this.$el.addClass(D.ClassName.BASE),this.containerWidth=D._getOuterWidth(this.element),this._itemMargin=this._getGutterSize(this.containerWidth),this._initItems(),B.on("resize."+t+"."+this.unique,this._getResizeFunction());var a=this.$el.css(["position","overflow"]),b=D._getOuterWidth(this.element);this._validateStyles(a),this._setColumns(b)}this.shuffle(this.group,this.initialSort),this.supported&&g(function(){this.destroyed||(this._setTransitions(),this.element.style[l]="height "+this.speed+"ms "+this.easing)},this)},D.prototype._getResizeFunction=function(){var b=a.proxy(this._onResize,this);return this.throttle?this.throttle(b,this.throttleTime):b},D.prototype._getElementOption=function(a){return"string"==typeof a?this.$el.find(a)[0]||null:a&&a.nodeType&&1===a.nodeType?a:a&&a.jquery?a[0]:null},D.prototype._validateStyles=function(a){"static"===a.position&&(this.element.style.position="relative"),"hidden"!==a.overflow},D.prototype._filter=function(a,b){a=a||this.lastFilter,b=b||this.$items;var c=this._getFilteredSets(a,b);return this._toggleFilterClasses(c.filtered,c.concealed),this.lastFilter=a,"string"==typeof a&&(this.group=a),c.filtered},D.prototype._getFilteredSets=function(b,c){var d=a(),e=a();return b===v?d=c:f(c,function(c){var f=a(c);this._doesPassFilter(b,f)||f.is(".ff-ad")?d=d.add(f):e=e.add(f)},this),{filtered:d,concealed:e}},D.prototype._doesPassFilter=function(b,c){if(a.isFunction(b))return b.call(c[0],c,this);var d=c.data(w),e=this.delimeter&&!a.isArray(d)?d.split(this.delimeter):d;return a.inArray(b,e)>-1},D.prototype._toggleFilterClasses=function(a,b){a.removeClass(D.ClassName.CONCEALED).addClass(D.ClassName.FILTERED),b.removeClass(D.ClassName.FILTERED).addClass(D.ClassName.CONCEALED)},D.prototype._initItems=function(b,c){var d=this;b=b||this.$items;var e,f,g,h,i=this.columnWidth(this.containerWidth,this._itemMargin),j=this.streamOpts.layout,k=44,l=21;this.itemCss.width=i,this.gridLayout=j,c||(b.addClass([D.ClassName.SHUFFLE_ITEM,D.ClassName.FILTERED].join(" ")),b.css(this.itemCss).data("point",new z).data("scale",x)),"grid"===j?(e=this.streamOpts["g-ratio-h"]*i/this.streamOpts["g-ratio-w"],e=Math.floor(e),f=Math.floor(e*this._altEval(this.streamOpts["g-ratio-img"])),h=b.first(),g=h.find(".ff-item-meta").height(),this._addStyleSheet(".ff-layout-grid .ff-item-cont { height: "+(e-k)+"px; /*overflow:hidden*/} .ff-layout-grid .ff-ad .ff-item-cont { height: "+e+"px; overflow:hidden} .ff-layout-grid .ff-has-overlay .ff-item-cont { height: "+e+"px; /*overflow:hidden*/} .ff-layout-grid .ff-item .ff-img-holder{height: "+f+"px}.ff-layout-grid .ff-has-overlay .ff-img-holder{height: "+e+"px}","ff-grid-css")):this.streamOpts.isOverlay&&(h=b.first(),g=h.find(".ff-item-meta").height()),console.log("_initItems",b),b.each(function(b){var h,m,n,o,p,q,r,s,t,u,v,w,x,y=a(this),z=y.data(),A=z.media&&z.media.split(";"),B=y.find(".ff-img-holder img"),C={},D=d.streamOpts.isOverlay&&B.length;A&&(h={width:A[4]||A[0],height:A[5]||A[1]},m=h.width&&h.height?d._calcImageProportion(i,h,j):0,B.css("minHeight",m)),("grid"===j||D)&&(t=y.find(D?".ff-overlay-wrapper":".ff-item-cont"),r=y.find(".ff-content"),s=t.find("> h4"),u=t.children(),D&&(u=u.not(".ff-overlay")),"label1"===d.streamOpts["icon-style"]&&y.is(".ff-meta-first")||(u=u.not(".ff-label-wrapper")),w=parseInt(u.first().css("marginTop")),x=parseInt(u.last().css("marginBottom")),q=.07*i,v=(u.length-1)*q+w+x,p=s.length?s.height():0,n=(e||m||B.height())-("ad"===y.data("type")?0:(B.length&&!D?f:0)+p+g+k)-v,console.log("textSpace "+b,n,l,p,n>=20?20:p?0:0>n?l+n-q:n),l>n&&(n=n>=20?20:p?0:0>n?l+n-q:n),C={height:n},r.css(C),0!==C.height&&r.length||(o=e-(B.length&&!D?f:0)-g-k-v,o=Math.floor(o),C={},l>=o&&(o>=20?(s.addClass("ff-header-min"),o=l):(o=0>o?l+o-q:o,C.textIndent="-9999px")),C.height=o,0>=o&&s.detach(),s.css(C)),c&&y.find(".ff-content").dotdotdot({ellipsis:"...",after:""}))}),console.log("init Items")},D.prototype._calcImageProportion=function(a,b,c){var d=a,e=d/b.width,f=Math.round(b.height*e);return f},D.prototype._addCSSRule=function(a,b,c){if(a&&a.cssRules){for(var d=a.cssRules.length-1,e=d;e>0;e--){var f=a.cssRules[e];f.selectorText===b&&(c=f.style.cssText+c,a.deleteRule(e),d=e)}return a.insertRule?a.insertRule(b+"{"+c+"}",d):a.addRule(b,c,d),a.cssRules[d].cssText}},D.prototype._altEval=function(a){return new Function("return "+a)()},D.prototype._addStyleSheet=function(a,b){var c=document.createElement("style");return c.type="text/css",b&&(c.id=b),/WebKit|MSIE/i.test(navigator.userAgent)?c.styleSheet?c.styleSheet.cssText=a:c.innerText=a:c.innerHTML=a,document.getElementsByTagName("head")[0].appendChild(c),c},D.prototype._updateItemCount=function(){this.visibleItems=this._getFilteredItems().length},D.prototype._setTransition=function(a){a.style[l]=q+" "+this.speed+"ms "+this.easing+", opacity "+this.speed+"ms "+this.easing},D.prototype._setTransitions=function(a){a=a||this.$items,f(a,function(a){this._setTransition(a)},this)},D.prototype._setSequentialDelay=function(a){this.supported&&f(a,function(a,b){a.style[m]="0ms,"+(b+1)*this.sequentialFadeDelay+"ms"},this)},D.prototype._getItems=function(){return this.$el.children(this.itemSelector)},D.prototype._getFilteredItems=function(){return this.destroyed?a():this.$items.filter("."+D.ClassName.FILTERED)},D.prototype._getConcealedItems=function(){return this.$items.filter("."+D.ClassName.CONCEALED)},D.prototype._getColumnSize=function(b,c){var d;return d=a.isFunction(this.columnWidth)?this.columnWidth(b,c):this.useSizer?D._getOuterWidth(this.sizer):this.columnWidth?this.columnWidth:this.$items.length>0?D._getOuterWidth(this.$items[0],!0):b,0===d&&(d=b),console.log("calc column width",d,c),d+c},D.prototype._getGutterSize=function(b){var c;return c=a.isFunction(this.gutterWidth)?this.gutterWidth(b):this.useSizer?D._getNumberStyle(this.sizer,"marginLeft"):this.gutterWidth,console.log("calc gutter size",c),c},D.prototype._setColumns=function(a){var b=a||D._getOuterWidth(this.element),c=this._itemMargin=this._getGutterSize(b),d=this._getColumnSize(b,c);this.containerWidth=b,b-=2*c;var e=(b+c)/d;this.cols=Math.max(Math.floor(e),1),this.colWidth=d},D.prototype._setContainerSize=function(){this.$el.css("height",this._getContainerSize())},D.prototype._getContainerSize=function(){return h(this.positions)},D.prototype._fire=function(a,b){this.$el.trigger(a+"."+t,b&&b.length?b:[this])},D.prototype._resetCols=function(){var a=this.cols;for(this.positions=[];a--;)this.positions.push(0)},D.prototype._layout=function(a,b){var c=this;f(a,function(a){c._layoutItem(a,!!b)},c),console.log("_layout"),c._processStyleQueue(),c._setContainerSize()},D.prototype._layoutItem=function(b,c){var d=a(b),e=d.data(),f=(e.point,e.scale,{width:D._getOuterWidth(b,!0),height:D._getOuterHeight(b,!0)}),g=this._getItemPosition(f);e.point=g,e.scale=x,this.styleQueue.push({$item:d,point:g,scale:x,width:this.itemCss.width,opacity:c?0:1,skipTransition:c,callfront:function(){c||d.css("visibility","visible")},callback:function(){c&&d.css("visibility","hidden")}})},D.prototype._getItemPosition=function(a,b){var c=this._getColumnSpan(a.width,this.colWidth,this.cols),d=this._getColumnSet(c,this.cols),e=this._getShortColumn(d,this.buffer),f=Math.round((this.containerWidth-(a.width*this.cols+this._itemMargin*(this.cols-1)))/2),g=new z(Math.round(this.colWidth*e+(f>0?f:0)),Math.round(d[e]));0!=g.y&&(g.y=g.y+this._itemMargin);for(var h=d[e]+a.height+(0!=g.y?this._itemMargin:0),i=this.cols+1-d.length,j=0;i>j;j++)this.positions[e+j]=h;return g},D.prototype._getColumnSpan=function(a,b,c){var d=a/b;return Math.abs(Math.round(d)-d)<u&&(d=Math.round(d)),Math.min(Math.ceil(d),c)},D.prototype._getColumnSet=function(a,b){if(1===a)return this.positions;for(var c=b+1-a,d=[],e=0;c>e;e++)d[e]=h(this.positions.slice(e,e+a));return d},D.prototype._getShortColumn=function(a,b){for(var c=i(a),d=0,e=a.length;e>d;d++)if(a[d]>=c-b&&a[d]<=c+b)return d;return 0},D.prototype._shrink=function(b){var c=b||this._getConcealedItems();f(c,function(b){var c=a(b),d=c.data();d.scale!==y&&(d.scale=y,this.styleQueue.push({$item:c,point:d.point,scale:y,opacity:0,callback:function(){c.css("visibility","hidden")}}))},this)},D.prototype._onResize=function(){if(this.enabled&&!this.destroyed&&!this.isTransitioning){var a=D._getOuterWidth(this.element);if(a!==this.containerWidth){if("grid"===this.gridLayout){var b=document.getElementById("ff-grid-css");b.parentNode.removeChild(b)}this._initItems(this.$items,!0),this.update()}}},D.prototype._getStylesForTransition=function(a,b){var c={opacity:a.opacity};return a.width&&(c.width=a.width),this.supported?c[p]=D._getItemTransformString(a.point,a.scale):(c.left=a.point.x,c.top=a.point.y),c},D.prototype._transition=function(b){var c=this._getStylesForTransition(b);b.$item.data("keep-pos")?(b.$item.removeData("keep-pos"),g(function(){this._startItemAnimation(b.$item,c,b.callfront||a.noop,b.callback||a.noop)},this,1e3)):this._startItemAnimation(b.$item,c,b.callfront||a.noop,b.callback||a.noop)},D.prototype._startItemAnimation=function(b,c,d,e){function f(b){b.target===b.currentTarget&&(a(b.target).off(o,f),e())}if(d(),!this.initialized)return b.css(c),void e();if(this.supported)b.css(c),b.on(o,f);else{var g=b.stop(!0).animate(c,this.speed,"swing",e);this._animations.push(g.promise())}},D.prototype._processStyleQueue=function(b){var c=a();f(this.styleQueue,function(a){a.skipTransition?this._styleImmediately(a):(c=c.add(a.$item),this._transition(a))},this),c.length>0&&this.initialized?(this.isTransitioning=!0,this.supported?(this._whenCollectionDone(c,o,this._movementFinished),this.isTransitioning=!1):(this._whenAnimationsDone(this._movementFinished),this.isTransitioning=!1)):b||g(this._layoutEnd,this),this.styleQueue.length=0},D.prototype._styleImmediately=function(a){D._skipTransition(a.$item[0],function(){a.$item.css(this._getStylesForTransition(a))},this)},D.prototype._movementFinished=function(){this._layoutEnd()},D.prototype._layoutEnd=function(){this.destroyed||this._fire(D.EventType.LAYOUT)},D.prototype._addItems=function(a,b,c){this._initItems(a),this._setTransitions(a),this.$items=this._getItems(),this._shrink(a),f(this.styleQueue,function(a){a.skipTransition=!0}),this._processStyleQueue(!0),b?this._addItemsToEnd(a,c):this.shuffle(this.lastFilter)},D.prototype._addItemsToEnd=function(a,b){var c=this._filter(null,a),d=c.get();this._updateItemCount(),this._layout(d,!0),b&&this.supported&&this._setSequentialDelay(d),this._revealAppended(d)},D.prototype._revealAppended=function(b){g(function(){f(b,function(b){var c=a(b);this._transition({$item:c,opacity:1,point:c.data("point"),scale:x})},this),this._whenCollectionDone(a(b),o,function(){a(b).css(m,"0ms"),this._movementFinished()})},this,this.revealAppendedDelay)},D.prototype._whenCollectionDone=function(b,c,d){function e(b){b.target===b.currentTarget&&(a(b.target).off(c,e),f++,f===g&&d.call(h))}var f=0,g=b.length,h=this;b.on(c,e)},D.prototype._whenAnimationsDone=function(b){a.when.apply(null,this._animations).always(a.proxy(function(){this._animations.length=0,b.call(this)},this))},D.prototype.shuffle=function(a,b){this.enabled&&!this.isTransitioning&&(a||(a=v),this._filter(a),this._updateItemCount(),this._shrink(),this.sort(b))},D.prototype.sort=function(a){if(this.enabled&&!this.isTransitioning){this._resetCols();var b=a||this.lastSort,c=this._getFilteredItems().sorted(b);this._layout(c),this.lastSort=b}},D.prototype.update=function(b){var c=this;console.log("SHUFFLE UPDATE"),this.enabled&&!this.isTransitioning&&(b||(this._setColumns(),this.$items.css("width",this.colWidth-this._itemMargin),this.$items.each(function(b,d){var e=a(this),f=e.data(),g=f.media&&f.media.split(";");if(g){var h={width:g[4],height:g[5]},i=c._calcImageProportion(c.colWidth-c._itemMargin,h);e.find(".ff-img-holder img").css("minHeight",i)}}),this.itemCss.width=this.colWidth-this._itemMargin),c.sort())},D.prototype.layout=function(){this.destroyed||this.update(!0)},D.prototype.appended=function(a,b,c){this._addItems(a,!0,!0)},D.prototype.disable=function(){this.enabled=!1},D.prototype.enable=function(a){this.enabled=!0,a!==!1&&this.update()},D.prototype.remove=function(b){function c(){b.remove(),this.$items=this._getItems(),this._updateItemCount(),this._fire(D.EventType.REMOVED,[b,this]),b=null}b.length&&b.jquery&&(this._toggleFilterClasses(a(),b),this._shrink(b),this.sort(),this.$el.one(D.EventType.LAYOUT+"."+t,a.proxy(c,this)))},D.prototype.destroy=function(){B.off("."+this.unique),this.$el.removeClass(t).removeAttr("style").removeData(t),this.$items.removeAttr("style").removeData("point").removeData("scale").removeClass([D.ClassName.CONCEALED,D.ClassName.FILTERED,D.ClassName.SHUFFLE_ITEM].join(" ")),this.$items=null,this.$el=null,this.sizer=null,this.element=null,this.destroyed=!0},a.fn.shuffleCustom=function(b){var c=Array.prototype.slice.call(arguments,1);return this.each(function(){var d=a(this),e=d.data(t);e?"string"==typeof b&&e[b]&&e[b].apply(e,c):(e=new D(this,b,"only_sort"===c[1]),d.data(t,e))})},a.fn.sorted=function(b){var d=a.extend({},a.fn.sorted.defaults,b),e=this.get(),f=!1;return e.length?d.randomize?k(e):(a.isFunction(d.by)&&e.sort(function(b,e){if(f)return 0;var g=d.by(a(b)),h=d.by(a(e));return g===c&&h===c?(f=!0,0):h>g||"sortFirst"===g||"sortLast"===h?-1:g>h||"sortLast"===g||"sortFirst"===h?1:0}),f?this.get():(d.reverse&&e.reverse(),e)):[]},a.fn.sorted.defaults={reverse:!1,by:null,randomize:!1},D}),function(a,b){var c,d=a.jQuery||a.Cowboy||(a.Cowboy={});d.throttle=c=function(a,c,e,f){function g(){function d(){i=+new Date,e.apply(j,l)}function g(){h=b}var j=this,k=+new Date-i,l=arguments;f&&!h&&d(),h&&clearTimeout(h),f===b&&k>a?d():c!==!0&&(h=setTimeout(f?g:d,f===b?a-k:a))}var h,i=0;return"boolean"!=typeof c&&(f=e,e=c,c=b),d.guid&&(g.guid=e.guid=e.guid||d.guid++),g},d.debounce=function(a,d,e){return e===b?c(a,d,!1):c(a,e,d!==!1)}}(this),function(a){"use strict";var b=null,c=a(window),d=function(b){var c=this;if(a.extend(c,d.options,b,d.settings),!a.isFunction(c.enter))throw new TypeError("Viewport.add :: No `enter` function provided in Viewport options.");"string"==typeof c.threshold&&c.threshold.indexOf("%")>-1?(c.isThresholdPercentage=!0,c.threshold=parseFloat(c.threshold)/100):c.threshold<1&&c.threshold>0&&(c.isThresholdPercentage=!0),c.hasLeaveCallback=a.isFunction(c.leave),c.$element=a(c.element),c.update()};d.prototype.update=function(){var a=this;a.offset=a.$element.offset(),a.height=a.$element.height(),a.$element.data("height",a.height),a.width=a.$element.width(),a.$element.data("width",a.width)},d.options={threshold:200,
delay:0},d.settings={triggered:!1,isThresholdPercentage:!1};var e=function(){this.init()};e.prototype={init:function(){var a=this;a.list=[],a.lastScrollY=0,a.windowHeight=c.height(),a.windowWidth=c.width(),a.screenSize={w:a.windowWidth,h:a.windowHeight},a.throttleTime=100,console.log("viewport init",a.screenSize),a.onResize(),a.bindEvents(),a.willProcessNextFrame=!0,requestAnimationFrame(function(){a.setScrollTop(),a.process(),console.log("viewport items processing.."),a.willProcessNextFrame=!1})},bindEvents:function(){var b,d=this;b=function(){setTimeout(function(){d.refresh()},0)},c.on("resize.viewport",a.proxy(d.onResize,d)),c.on("scroll.viewport",a.throttle(d.throttleTime,a.proxy(d.onScroll,d))),d.hasActiveHandlers=!0},unbindEvents:function(){c.off(".viewport"),this.hasActiveHandlers=!1},maybeUnbindEvents:function(){var a=this;a.list.length||a.unbindEvents()},add:function(a){var b=this;b.list.push(a),b.hasActiveHandlers||b.bindEvents(),b.willProcessNextFrame||(b.willProcessNextFrame=!0,requestAnimationFrame(function(){b.willProcessNextFrame=!1,b.process()}))},saveDimensions:function(){var b=this;a.each(b.list,function(a,b){b.update()}),b.windowHeight=c.height(),b.windowWidth=c.width(),b.screenSize={w:b.windowWidth,h:b.windowHeight}},onScroll:function(){var a=this;a.list.length&&(a.setScrollTop(),a.process())},onResize:function(){this.refresh()},refresh:function(){this.list.length&&this.saveDimensions()},isInViewport:function(a){var b,c=this,d=a.offset,e=a.threshold,f=e,g=c.lastScrollY;return a.isThresholdPercentage&&(e=0),b=c.isTopInView(g,c.windowHeight,d.top,a.height,e),b&&a.isThresholdPercentage&&(b=c.isTopPastPercent(g,c.windowHeight,d.top,a.height,f)),b},isTopInView:function(a,b,c,d,e){var f=a+b;return c+e>=a&&f>c+e},isTopPastPercent:function(a,b,c,d,e){var f=a+b,g=f-c,h=g/b;return h>=e},isOutOfViewport:function(a,b){var c,d=this,e=a.offset,f=d.lastScrollY;return"bottom"===b&&(c=!d.isBottomInView(f,d.windowHeight,e.top,a.height)),c},isBottomInView:function(a,b,c,d){var e=a+b,f=c+d;return f>a&&e>=f},triggerEnter:function(b){var c=this;setTimeout(function(){b.enter.call(b.element,b)},b.delay),a.isFunction(b.leave)?b.triggered=!0:c.list.splice(a.inArray(b,c.list),1),c.maybeUnbindEvents()},getScreenSize:function(){return this.screenSize},triggerLeave:function(a){setTimeout(function(){a.leave.call(a.element,a)},a.delay),a.triggered=!1},setScrollTop:function(){this.lastScrollY=c.scrollTop()},process:function(){var b=this,c=a.extend([],b.list);a.each(c,function(a,c){var d=b.isInViewport(c),e=c.hasLeaveCallback&&b.isOutOfViewport(c,"bottom");return!c.triggered&&d?b.triggerEnter(c):!d&&e&&c.triggered?b.triggerLeave(c):void 0})}},e.add=function(a){var b=e.getInstance();return b.add(new d(a))},e.refresh=function(){e.getInstance().refresh()},e.getInstance=function(){return b||(b=new e),b},window.FF_Viewport=e}(jQuery),function(a,b,c){"use strict";function d(a,b){a.style.WebkitTransform=b,a.style.msTransform=b,a.style.transform=b}function e(){var b=i.clientWidth,c=a.innerWidth;return c>b?c:b}function f(){var b=i.clientHeight,c=a.innerHeight;return c>b?c:b}function g(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function h(a,b){return this.el=a[0],this.$el=a,this.options=g({},this.options),g(this.options,b),this._init()}var i=a.document.documentElement,j={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},k=j[b.prefixed("transition")],l={transitions:b.csstransitions,support3d:b.csstransforms3d};h.prototype.options={},h.prototype._init=function(){return this.$body=c("body"),this.grid=this.el.querySelector(".ff-stream-wrapper"),this.gridItems=[].slice.call(this.grid.querySelectorAll(".ff-item:not(.ff-ad)")),this.itemsCount=this.gridItems.length,this.$wrapper=this.$el.find(".ff-slideshow"),this.slideshow=this.el.querySelector(".ff-slideshow > ul"),this.$slideshow=c(this.slideshow),this.$slideshow.data("media",!1),this.$wrapper.addClass("ff-"+this.options.iconStyle+"-icon"),this._addSlideShowItems(this.gridItems),this.slideshowItems=[].slice.call(this.slideshow.children),this.current=-1,this.ctrlPrev=this.el.querySelector(".ff-nav-prev"),this.ctrlNext=this.el.querySelector(".ff-nav-next"),this.ctrlClose=this.el.querySelector(".ff-nav-close"),this._initEvents(),this},h.prototype._addSlideShowItems=function(b){var d=this;b.forEach(function(b,e){var f,g,h,i,j,k=c(b),l=c('<li><div class="ff-slide-wrapper"></div></li>'),m=l.find(".ff-slide-wrapper"),n=k.find(".picture-item__inner").children().clone(),o=k.attr("data-type"),p="",q=!1;k.attr("data-media")?(d.$slideshow.data("media",!0),h=k.attr("data-media").split(";"),f=c('<div class="ff-media-wrapper'+("image"==h[3]?"":" ff-video")+'" style="width: 100%; max-height: '+h[1]+'px;"></div>'),m.prepend(f),"image"==h[3]?(j=parseInt(h[0]),i=j>590?590/j*parseInt(h[1]):h[1],p='<span class="ff-img-holder" style="width: '+h[0]+"px; max-height: "+h[1]+"px; height: "+i+"px; background-image: url("+h[2]+');"></span>',f.addClass("ff-slide-img-loading").data("media-image",h[2])):"video/mp4"==h[3]?p='<video controls width="'+h[0]+'" height="'+h[1]+'"><source src="'+h[2]+'" type="video/mp4">Your browser does not support the video tag.</video>':(h[2]=h[2].replace("http:","").replace("https:","").replace("/v/","/embed/").replace("autoplay=1","autoplay=0&fs=1"),p='<iframe width="'+h[0]+'" height="'+h[1]+'" src="'+h[2]+'" frameborder="0" allowfullscreen webkitallowfullscreen mozallowfullscreen autoplay="1" wmode="opaque"></iframe>',h[2].indexOf("facebook.com/video/embed")+1&&f.after('<span class="ff-cta">(Click image to play video)</span>')),f.data("media",p),n.find(".ff-img-holder").remove()):n.find(".ff-img-holder").length&&n.find(".ff-img-holder").each(function(a,b){var d=c(this),e=c(this).find("img"),f=e.get(0);q?d.remove():(d.removeClass("ff-img-loading").addClass("ff-img-loaded").css({"background-image":'url("'+f.src+'")',width:parseInt(f.style.width),height:parseInt(f.style.height)}),e.remove(),q=!0)}),m.append(n.not(".ff-img-holder")),g=m.find(".ff-item-cont"),/posts/.test(o)&&(o="wordpress"),g.append(l.find("h4")),g.append(l.find(".ff-article")),g.append(l.find(".ff-content").prepend(l.find(".ff-img-holder"))),g.append(l.find(".ff-item-meta")),g.find(".ff-userpic").append(l.find(".ff-icon")),g.find(".ff-item-meta").prepend(g.find(".ff-userpic")).prepend(m.find(".ff-item-bar")),g.find(".ff-timestamp").before("<br>").before('<span class="ff-posted">'+a.FlowFlowOpts.posted_on+" <span>"+o+"</span></span>"),l.find(".ff-content").each(function(){var a=c(this);a.is(":empty")?a.remove():a.wrap('<div class="ff-table"/>')}),d.$slideshow.append(l.attr("data-type",k.attr("data-type")))}),d.$slideshow.data("media")&&d.$slideshow.addClass("ff-slideshow-media")},h.prototype._initEvents=function(b){var d=this;this.initItemsEvents(this.gridItems),c(this.ctrlPrev).on("click",function(){d._navigate("prev")}),c(this.ctrlNext).on("click",function(){d._navigate("next")}),c(this.ctrlClose).on("click",function(){d._closeSlideshow()}),this.$wrapper.on("click",function(a){c(a.target).closest("li, nav").length||d._closeSlideshow()}),c(a).on("resize",function(){d._resizeHandler()}),c(document).on("keydown",function(a){if(d.isSlideshowVisible){var b=a.keyCode||a.which;switch(b){case 37:d._navigate("prev");break;case 39:d._navigate("next");break;case 27:d._closeSlideshow()}}})},h.prototype.initItemsEvents=function(a,b){var d=this,e=c(this.grid).data("opts")&&c(this.grid).data("opts").titles;b=b||0,a.forEach(function(a,f){c(a).find(".picture-item__inner").on("click",function(a){var g=c(a.target),h=g.closest("a"),i=g.closest("h4").length,j=g.closest(".ff-icon-share").length;if(h.length&&!g.is("img")||j){if("yep"===e&&i)return;if(!i)return}a.preventDefault(),console.log("open slide"),d._openSlideshow(f+b)})})},h.prototype._freezeScroll=function(a){a.preventDefault()},h.prototype.checkScrollbar=function(){this.bodyIsOverflowing=document.body.scrollHeight>document.documentElement.clientHeight,this.scrollbarWidth=this.measureScrollbar()},h.prototype.setScrollbar=function(){var a=parseInt(this.$body.css("padding-right")||0,10);this.bodyIsOverflowing&&this.$body.css("padding-right",a+this.scrollbarWidth)},h.prototype.resetScrollbar=function(){this.$body.css("padding-right","")},h.prototype.measureScrollbar=function(){var a=document.createElement("div");a.className="ff-modal-scrollbar-measure",this.$body.append(a);var b=a.offsetWidth-a.clientWidth;return this.$body[0].removeChild(a),b},h.prototype._openSlideshow=function(a){this.isSlideshowVisible=!0,this.current=a,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("ff-modal-open");var b=this;b._setViewportItems();var g=c(b.currentItem),h=c(b.nextItem),i=c(b.prevItem),j=e(),k=f();b.$curr=g,g.find(".ff-media-wrapper").each(function(a,b){var d=c(this);if(d.data("media")&&"inserted"!==d.data("media")){if(d.data("media-image")){var e=new Image;e.src=d.data("media-image"),e.onload=function(){d.removeClass("ff-slide-img-loading")}}d.prepend(d.data("media")),d.data("media","inserted")}}),h.add(i).find(".ff-media-wrapper").each(function(a,b){var d=c(this),e=d.data("media");if(e&&"inserted"!==e&&!/iframe|video/.test(e)){if(d.data("media-image")){var f=new Image;f.src=d.data("media-image"),f.onload=function(){d.removeClass("ff-slide-img-loading")}}d.prepend(d.data("media")),d.data("media","inserted")}}),g.addClass("ff-current ff-show");var m=parseInt(Number(1*(b.currentItem.offsetHeight/2)));if(2*m>k?m=parseInt(k/2)-25:b.$slideshow.bind("mousewheel DOMMouseScroll",b._freezeScroll),d(b.currentItem,l.support3d?"translate3d("+parseInt(Number(-1*(b.currentItem.offsetWidth/2)))+"px, -"+m+"px, 0px)":"translate(-50%, -50%)"),b.prevItem){i.addClass("ff-show");var n=Number(-1*(j/2+b.prevItem.offsetWidth/2));d(b.prevItem,l.support3d?"translate3d("+(n+100)+"px, -50%, 0px)":"translate("+n+"px, -50%)")}if(b.nextItem){h.addClass("ff-show");var n=Number(j/2+b.nextItem.offsetWidth/2);d(b.nextItem,l.support3d?"translate3d("+(n-100)+"px,-50%, 0px)":"translate("+n+"px, -50%)")}setTimeout(function(){b.$wrapper.addClass("ff-slideshow-open").scrollTop(0)},200)},h.prototype._navigate=function(a){if(!this.isAnimating){if("next"===a&&this.current===this.itemsCount-1||"prev"===a&&0===this.current)return void this._closeSlideshow();this.isAnimating=!0,this._setViewportItems();var b,g,h,i=this,j=e(),m=f(),n=this.currentItem.offsetWidth,o=l.support3d?"translate3d(-"+Number(j/2+n/2)+"px, -50%, -150px)":"translate(-"+Number(j/2+n/2)+"px, -50%)",p=l.support3d?"translate3d("+Number(j/2+n/2)+"px, -50%, -150px)":"translate("+Number(j/2+n/2)+"px, -50%)";"next"===a?(b=l.support3d?"translate3d( -"+Number(2*j/2+n/2)+"px, -50%, -150px )":"translate(-"+Number(2*j/2+n/2)+"px, -50%)",g=l.support3d?"translate3d( "+Number(2*j/2+n/2)+"px, -50%, -150px )":"translate("+Number(2*j/2+n/2)+"px, -50%)"):(b=l.support3d?"translate3d( "+Number(2*j/2+n/2)+"px, -50%, -150px )":"translate("+Number(2*j/2+n/2)+"px)",g=l.support3d?"translate3d( -"+Number(2*j/2+n/2)+"px, -50%, -150px )":"translate(-"+Number(2*j/2+n/2)+"px, -50%)"),i.$slideshow.removeClass("ff-animatable"),("next"===a&&this.current<this.itemsCount-2||"prev"===a&&this.current>1)&&(h=this.slideshowItems["next"===a?this.current+2:this.current-2],d(h,g),c(h).addClass("ff-show").find(".ff-media-wrapper").each(function(a,b){var d=c(this),e=d.data("media");if(e&&"inserted"!==e&&!/iframe|video/.test(e)){if(d.data("media-image")){var f=new Image;f.src=d.data("media-image"),f.onload=function(){d.removeClass("ff-slide-img-loading")}}d.prepend(d.data("media")),d.data("media","inserted")}}));var q=function(){var e;i.$slideshow.addClass("ff-animatable"),i.$curr.removeClass("ff-current");var f="next"===a?i.nextItem:i.prevItem;c(f).addClass("ff-current").find(".ff-media-wrapper").each(function(a,b){var d=c(this),e=d.data("media");if(e&&"inserted"!==e){if(d.data("media-image")){var f=new Image;f.src=d.data("media-image"),f.onload=function(){d.removeClass("ff-slide-img-loading")}}d.prepend(d.data("media")),d.data("media","inserted")}}),d(i.currentItem,"next"===a?o:p),i.nextItem&&(e=parseInt(Number(1*(i.nextItem.offsetHeight/2))),2*e>m?(e=parseInt(m/2)-25,"next"===a&&i.$slideshow.off("mousewheel DOMMouseScroll",i._freezeScroll)):"next"===a&&(i.$slideshow.on("mousewheel DOMMouseScroll",i._freezeScroll),i.$wrapper.scrollTop(0)),d(i.nextItem,"next"===a?l.support3d?"translate3d("+parseInt(Number(-1*(i.nextItem.offsetWidth/2)))+"px, -"+e+"px, 0px)":"translate(-50%, -50%)":b)),i.prevItem&&(e=parseInt(Number(1*(i.prevItem.offsetHeight/2))),2*e>m?(e=parseInt(m/2)-25,"prev"===a&&i.$slideshow.off("mousewheel DOMMouseScroll",i._freezeScroll).scrollTop(0)):"prev"===a&&(i.$slideshow.on("mousewheel DOMMouseScroll",i._freezeScroll),i.$wrapper.scrollTop(0)),d(i.prevItem,"next"===a?b:l.support3d?"translate3d("+parseInt(Number(-1*(i.prevItem.offsetWidth/2)))+"px, -"+e+"px, 0px)":"translate(-50%, -50%)")),h&&d(h,"next"===a?p:o);var g=function(b){if(l.transitions&&j>=800){if(-1===b.originalEvent.propertyName.indexOf("transform"))return!1;c(this).off(k,g)}i.prevItem&&"next"===a?c(i.prevItem).removeClass("ff-show"):i.nextItem&&"prev"===a&&c(i.nextItem).removeClass("ff-show"),i._resetMedia(c(i.currentItem)),"next"===a?(i.prevItem=i.currentItem,i.currentItem=i.nextItem,h&&(i.nextItem=h)):(i.nextItem=i.currentItem,i.currentItem=i.prevItem,h&&(i.prevItem=h)),i.$curr=c(i.currentItem),i.current="next"===a?i.current+1:i.current-1,i.isAnimating=!1};l.transitions&&j>=800?i.$curr.on(k,g):g()};setTimeout(q,25)}},h.prototype._closeSlideshow=function(a){this.$wrapper.removeClass("ff-slideshow-open"),this.$slideshow.removeClass("ff-animatable").unbind("mousewheel DOMMouseScroll",this._freezeScroll),this.resetScrollbar(),this.$body.removeClass("ff-modal-open");var b=this,e=function(a){if(l.transitions&&a){if("section"!==a.target.tagName.toLowerCase())return;c(this).off(k,e)}var f=c(b.currentItem);b.$curr=f,f.removeClass("ff-current"),f.removeClass("ff-show"),b._resetMedia(f),b.prevItem&&c(b.prevItem).removeClass("ff-show"),b.nextItem&&c(b.nextItem).removeClass("ff-show"),b.slideshowItems.forEach(function(a){d(a,"")}),b.isSlideshowVisible=!1};l.transitions?this.$wrapper.on(k,e):e()},h.prototype._resetMedia=function(a){var b=a.attr("data-type");if("vine"!==b&&"soundcloud"!==b){var c=a.find(".ff-video"),d=c.find("iframe, video");c.prepend(d)}},h.prototype._setViewportItems=function(){this.currentItem=null,this.prevItem=null,this.nextItem=null,this.$curr=null,this.current>0&&(this.prevItem=this.slideshowItems[this.current-1]),this.current<this.itemsCount-1&&(this.nextItem=this.slideshowItems[this.current+1]),this.currentItem=this.slideshowItems[this.current],this.$curr=c(this.currentItem)},h.prototype._resizeHandler=function(){function a(){b._resize(),b._resizeTimeout=null}var b=this;this._resizeTimeout&&clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(a,50)},h.prototype._resize=function(){if(this.isSlideshowVisible){if(this.prevItem){var a=Number(-1*(e()/2+this.prevItem.offsetWidth/2));d(this.prevItem,l.support3d?"translate3d("+a+"px, -50%, -150px)":"translate("+a+"px, -50%)")}if(this.nextItem){var a=Number(e()/2+this.nextItem.offsetWidth/2);d(this.nextItem,l.support3d?"translate3d("+a+"px, -50%, -150px)":"translate("+a+"px, -50%)")}}},a.CBPGridGallery=h}(window,window.CustomModernizr,window.jQuery),function(a){function b(a,b,c,d){var e=c/b,f=Math.round(a*e);return f}function c(b,c,d,f){var g=e(d,c);return g.filtered.each(function(){var b=a(this);b.add(b.find(".ff-img-holder, .picture-item__inner")).removeAttr("style")}),g.concealed.hide(),a(b).data("group",g.filtered),g.filtered}function d(a,b,c){for(var d=0,e=a.length;e>d;d++)if(b.call(c,a[d],d,a)==={})return}function e(b,c){var e=a(),g=a();return d(c,function(c){var d=a(c);f(b,d)||d.is(".ff-ad")?e=e.add(d):g=g.add(d)},this),{filtered:e,concealed:g}}function f(a,b){return a.call(b[0],b)}function g(c,d,e){function f(a,b){var c,d,e;for(c=b.length;c--;)if(e=b[c].size,e>a){d=parseInt(b[c].val);break}return d}var g,h,i,j,k,l,m=0,n=[],e=jQuery.makeArray(e||c.querySelectorAll(d.itemSelector)),o=e.length,p=a(c),q=a(e),r=44,s=21,t=c.getBoundingClientRect(),u=d.sizes.spacing;for(j=u.length;j--;)if(l=u[j].size,t.width<l){k=parseInt(u[j].val);break}for(var v,w,x,y,z=Math.floor(t.right-t.left)-2*k,A=[],g=f(z,d.sizes.row),B=f(z,d.sizes.spacing),j=0;o>j;++j)v=e[j].getElementsByTagName("img")[0],!v||e[j].className.indexOf("ff-ad")+1?(w=300,x=g):(y=v.getAttribute("data-size"),y&&(y=y.split(";"),w=parseInt(y[0]),x=parseInt(y[1])),w&&x||((w=parseInt(v.getAttribute("width")))||v.setAttribute("width",w=v.offsetWidth),(x=parseInt(v.getAttribute("height")))||v.setAttribute("height",x=v.offsetHeight))),A[j]={width:b(w,x,g,B),height:g};p.css("padding","0 "+k+"px"),o=e.length;for(var C=0;o>C;++C){if(e[C].classList?(e[C].classList.remove(d.firstItemClass),e[C].classList.remove(d.lastRowClass)):e[C].className=e[C].className.replace(new RegExp("(^|\\b)"+d.firstItemClass+"|"+d.lastRowClass+"(\\b|$)","gi")," "),m+=A[C].width,n.push(e[C]),C===o-1)for(var D=0;D<n.length;D++)0===D&&(n[D].className+=" "+d.lastRowClass),n[D].style.cssText="width: "+A[C+parseInt(D)-n.length+1].width+"px;height: "+A[C+parseInt(D)-n.length+1].height+"px;margin-right:"+(D<n.length-1?B+"px":0);if(m+B*(n.length-1)>z){for(var E,F=m+B*(n.length-1)-z,G=(n.length,0),D=0;D<n.length;D++){E=n[D];var H=A[C+parseInt(D)-n.length+1].width,I=H-H/m*F,J=Math.round(A[C+parseInt(D)-n.length+1].height*(I/H));G+1-I%1>=.5?(G-=I%1,I=Math.floor(I)):(G+=1-I%1,I=Math.ceil(I)),E.style.cssText="width: "+I+"px;height: "+J+"px;margin-right: "+(D<n.length-1?B:0)+"px;margin-bottom: "+B+"px",E.querySelectorAll(".ff-img-holder").length?E.querySelectorAll(".ff-img-holder")[0].style.cssText="width: "+I+"px;height: "+J+"px;":E.querySelectorAll(".picture-item__inner")[0].style.cssText="width: "+I+"px;height: "+J+"px;",a(E).data("newHeight",J),a(E).data("newWidth",I),0===D&&(E.className+=" "+d.firstItemClass)}n=[],m=0}}i=q.not(".ff-ad").first(),h=i.find(".ff-item-meta").height(),q.each(function(b){var c,e,f,g,i,j,k,l,m,n,o,p=a(this),q=p.data(),t=(q.media&&q.media.split(";"),p.find(".ff-img-holder img")),u={},v=!!t.length;k=p.find(v?".ff-overlay-wrapper":".ff-item-cont"),i=p.find(".ff-content"),j=p.find(".ff-overlay-wrapper > h4"),l=k.children(),l=l.not(".ff-overlay"),"label1"===d.streamOpts["icon-style"]&&p.is(".ff-meta-first")||(l=l.not(".ff-label-wrapper")),n=parseInt(l.first().css("marginTop")),o=parseInt(l.last().css("marginBottom")),g=.07*p.data("newWidth"),m=(l.length-1)*g+n+o,f=j.length?j.height():0,c=p.data("newHeight")-f-h-r-m,s>c&&(c=c>=20?20:f?0:0>c?s+c-g:c),u={height:c},i.css(u),0!==u.height&&i.length||(e=p.data("newHeight")-h-r-m,e=Math.floor(e),u={},s>=e&&(e+g>=20?(j.addClass("ff-header-min"),e=s):(e=0>e?s+e-g:e,u.textIndent="-9999px")),u.height=e,0>=e&&j.detach(),j.css(u))})}a.fn.rowGrid=function(b,d){return this.each(function(){var e,f,h=a(this);"appended"===b?(b=h.data("grid-options"),f=h.children("."+b.lastRowClass),e=f.nextAll(b.itemSelector).add(f),g(this,b,e)):"shuffle"===b?(b=h.data("grid-options"),e=h.data("items"),e=c(this,e,d),g(this,b,e)):(b=a.extend({},a.fn.rowGrid.defaults,b),h.data("grid-options",b),g(this,b),b.resize&&a(window).on("resize.rowGrid",{container:this},function(c){var d=a(c.data.container).data("group");d&&d.each(function(){var b=a(this);b.add(b.find(".ff-img-holder, .picture-item__inner")).removeAttr("style")}),a(c.data.container).find(".ff-item:not(.ff-ad) .ff-content").dotdotdot({ellipsis:"...",after:""}),g(c.data.container,b,d)}))})},a.fn.rowGrid.defaults={minMargin:null,maxMargin:null,resize:!0,lastRowClass:"last-row",firstItemClass:null}}(jQuery),function(a){"use strict";function b(a){if(document.createEvent){var b=document.createEvent("MouseEvents");b.initEvent("click",!1,!0),a.dispatchEvent(b)}else document.createEventObject?a.fireEvent("onclick"):"function"==typeof a.onclick&&a.onclick()}function c(a,b,c,e){if(a=Number(a),e=e||!1,e!==!1)return d(a,b,c,e);var f;return f=a>=1e12?"T":a>=1e9?"B":a>=1e6?"M":a>=1e3?"K":"",d(a,b,c,f)}function d(a,b,c,d){var e=0;switch(d){case"T":e=a/1e12;break;case"B":e=a/1e9;break;case"M":e=a/1e6;break;case"K":e=a/1e3;break;case"":e=a}if(b!==!1){var f=new RegExp("\\.\\d{"+(b+1)+",}$");f.test(""+e)&&(e=e.toFixed(b))}return c!==!1&&(e=Number(e).toFixed(c)),e+d}var e,f,g=a("html"),h=navigator.userAgent.toLowerCase(),i=/safari|chrome/.test(h),j=/android|blackBerry|iphone|ipad|ipod|opera mini|iemobile/i.test(h),k=/msie|trident.*rv\:11\./.test(h),l=/firefox/.test(h),m=!1,n=window.FlowFlowOpts;if(k){if(/msie 8/.test(h))return;e=/msie 9/.test(h)}g.addClass("ff-browser-"+(i?/chrome/.test(h)?"chrome":"safari":k?"ie"+(e?" ff-ie9":""):l?"ff":"")),a.expr.createPseudo&&"function"==typeof a.expr.createPseudo?a.expr[":"].contains=a.expr.createPseudo(function(b){return function(c){return a(c).text().toUpperCase().indexOf(b.toUpperCase())>=0}}):jQuery.expr[":"].contains=function(a,b,c){return jQuery(a).text().toUpperCase().indexOf(c[3].toUpperCase())>=0};var o=function(a){function d(){return a(document).bind("ffimgloaded",function(a,b){var c=b.$grid.data("shuffle");c&&c.layout()}),d=function(){return o},o}function e(c,d,e,f){var i,k,l,m,o,q,t,u,v,w,x="";if(!d.feeds||"[]"===d.feeds)return"<p>No feeds to show. Add at least one</p>";if(!d.layout)return"<p>Please choose stream layout on options page</p>";"string"==typeof d.feeds&&(d.feeds=JSON.parse(d.feeds)),q=d.feeds,d.hash=c.hash,d["next-page"]=c.page+1,d.countOfPages=c.countOfPages;var y=c.items,z=0,A=y.length,C=a('[id^="ff-uid-"]').length+1||1;if("yep"===d.gallery){var D=window.FlowFlowOpts.lightbox_navigate;x+='<section class="ff-slideshow"><ul></ul><nav><span class="ff-nav-prev"></span><span class="icon ff-nav-next"></span><span class="ff-nav-close"></span></nav><div class="ff-nav-info-keys">'+D+"</div></section>"}if(x+='<div class="ff-header ff-loading">',d.heading&&(x+="<h1>"+d.heading.replace(/\\/g,"")+"</h1>"),d.subheading&&(x+="<h2>"+d.subheading.replace(/\\/g,"")+"</h2>"),"yep"===d.filter){for(t="",u={},v=0,z=0;A>z;z++)u[y[z].type]=1;for(var E in u)"ad"!==E&&(v+=1,t+='<span class="ff-filter ff-type-'+E+'" data-filter="'+E+'"></span>');x+='<div class="ff-filter-holder">'+(v>1?'<span class="ff-filter ff-type-all ff-filter--active">'+n.filter_all+"</span>"+t:"")+'<span class="ff-search"><input type="text" placeholder="'+n.filter_search+'"/></span></div>'}if(e&&(n.moderation=e,x+='<div class="ff-moderation-holder"><p><strong>PREMODERATION MODE IS ON</strong>. APPROVE POSTS AND HIT <strong>APPLY CHANGES</strong>.</p><span class="ff-moderation-button ff-moderation-apply">Apply changes</span><span class="ff-moderation-button ff-moderation-approve-new">Approve new posts</span></div>'),x+="</div>",o=d["gc-style"],x+='<div class="ff-stream-wrapper ff-'+(j?"mobile":"desktop")+" shuffle--container"+("yep"===d.viewportin&&!j&&window.requestAnimationFrame?" shuffle--animatein":" shuffle--animateoff")+" ff-layout-"+d.layout+" ff-upic-"+d["upic-pos"]+" ff-upic-"+d["upic-style"]+" ff-align-"+d.talign+" ff-sc-"+d["icon-style"]+" ff-"+d["icons-style"]+'-icon">',w=p(y,C,!0,e,d),x+=w,x+='<div class="shuffle__sizer"></div></div>',c.countOfPages>1&&c.page+1!=c.countOfPages&&("yep"!==d.mobileslider||!j)&&(x+='<div class="ff-loadmore-wrapper"><span class="ff-btn">'+window.FlowFlowOpts.show_more+"</span></div>"),i=a(x),i.each(function(b){return this.className.indexOf("ff-stream-wrapper")+1?(k=a(this),!1):void 0}),l=i.find(".ff-item"),m=l.not(".ff-ad"),k.data("opts",d).data("items",l),m.each(function(){var b=a(this),c=b.is(".ff-image");c?b.find("img").not(".ff-initial-image").remove():b.find("img").not(":first").remove()}),i.find("p:empty, .ff-content a:empty").remove(),console.log("prepareImage"),i.find("img").each(function(){h.apply(this,[k])}),i.find(".ff-filter").click(function(){i.find(".ff-filter--active").removeClass("ff-filter--active");var b=a(this).addClass("ff-filter--active").attr("data-filter");s(k,b)}),i.find(".ff-search input").on("keyup",function(){var a=this.value.toLowerCase();r(k,a)}),i.on("click","a",function(){var b,c=a(this);return c.closest(".ff-share-popup").length?(b=a(this).attr("href"),window.open(b,"sharer","toolbar=0,status=0,width=626,height=436"),!1):c.is(".ff-no-link")&&("nope"===d.gallery||j)?!1:void 0}),i.on("click",".ff-icon-share",function(b){var c=a(this),d=c.parent();return d.data("opened")?(d.removeClass("ff-popup__visible"),d.data("opened",!1)):(d.addClass("ff-popup__visible"),d.data("opened",!0)),!1}),"nope"===d.gallery?(k.addClass("ff-gallery-off").on("click",'.ff-item:not(".ff-ad") .picture-item__inner',function(c){var d=a(c.target),e=a(this),f=d.closest("a");return!f.length||d.is("img")?(j?e.toggleClass("ff-taped"):b(e.find(".ff-timestamp")[0]),!1):void 0}),k.on("click",".ff-timestamp",function(a){a.stopImmediatePropagation()})):k.addClass("ff-gallery-on"),"yep"===n.open_in_new){var F=location.hostname;i.find("a").filter(function(){return this.hostname!=F}).attr("target","_blank")}g(m,d),e&&B(i,y,d),H[d.id]=k;for(var G in f)f[G]&&this[G].init(k);return i}function g(b,c){console.log("adjustItems");for(var d,e=0,f=c.template.length;f>e;e++)"image"===c.template[e]&&(d=e);b.each(function(b,c){var e,f,g=a(c),h=g.find(".ff-img-holder"),i="insertBefore";h.closest(".ff-content").length&&(e=g.find(".ff-item-cont").children().not(".ff-label-wrapper"),d>=e.length?(f=e.length-1,d>e.length&&(i="insertAfter")):f=d,h[i](e.eq(f))),g.addClass("ff-"+(h.length?"":"no-")+"image")})}function h(b){var c,d,e,f,g=a(this),h=this,i=g.parent(),j=i.is("a")?i:g;e=g.data("size"),e&&(c=e.split(";")[1],d=c&&0!=c),d||(c=g.attr("height")||g.height(),d=c&&0!=c),i.is(".ff-img-holder")||(g.removeAttr("width").removeAttr("height"),f=a('<span class="ff-img-holder ff-img-loading" style="width: 100%;max-height: none"></span>'),j.wrap(f)),h.onload=function(){d||(console.log("trigger('ffimgloaded'"),a(document).trigger("ffimgloaded",{$grid:b})),g.closest(".ff-img-holder").removeClass("ff-img-loading").addClass("ff-img-loaded"),g=null,h=null},h.onerror=function(){g.closest(".ff-img-holder").removeClass("ff-img-loading").addClass("ff-img-loaded"),g=null,h=null},i=null,j=null}function i(a){a.$el.layout()}function k(a){var b,c,d,e,f,g,h,i=0,j=n.server_time,k=j-a,m=new Date(1e3*a),o=E.length-1;for(h=o;h>=0&&(b=k/E[h])<=1;h--);switch(0>h&&(h=0),b=Math.floor(b),h){case 3:if(1==b){c=n.dates.Yesterday;break}case 4:case 5:e=m.getMonth(),f=m.getDate(),c=F[e]+" "+f;break;case 6:case 7:e=m.getMonth(),f=m.getDate(),g=m.getFullYear(),c=F[e]+" "+f+", "+g;break;default:d=j-k%E[h],c=l(b,j,d,i,h)}return c}function l(a,b,c,d,e){var f=G;f=f[e];var g=a+f;return g+" "+n.dates.ago}function p(a,b,d,e,f,g){var h,i,k,l,m,o,p,q,r,s,t,u,v,w,x,y,z,A,B=a.length,E="",F="",G="",H=f["icon-style"]&&f["icon-style"].indexOf("stamp")>-1,I=b;for(g||(g=0),f&&"randomCompare"==f.order&&(a=C(a)),h=0;B>h;h++){if(k=a[h],i=h+1,r=G=q=A=F="",w={},z=f.isOverlay&&(!!k.img||-1!==k.text.indexOf("<img")),"ad"!==k.type){p="undefined"!=typeof k.source?k.source:k.permalink,console.log("_uid mod",I),e&&k.mod&&(x="new"==k.status?" ff-moderation-new-post":"",y="approved"==k.status?"checked":"",F='<div class="ff-moderation-wrapper '+("approved"==k.status?"ff-approved":"")+x+'"><span>Approve</span> <label for="ff-mod-'+(I+g)+'"><input id="ff-mod-'+(I+g)+'" type="checkbox" class="ff-switcher" value="yes" '+y+"/><div><span></span></div></label></div>"),console.log("_uid mod",b,g,"ff-mod-"+(b+g)),k.additional&&("twitter"===k.type&&(r+='<a href="https://twitter.com/intent/tweet?in_reply_to='+k.id+'" class="ff-comments"> <i class="ff-icon-reply"></i></a>'),v=parseInt(k.additional.views),v>-1&&(r+='<a href="'+k.permalink+'" class="ff-views"><i class="ff-icon-view"></i> <span>'+(0>v?"":c(v,2))+"</span></a>"),s=parseInt(k.additional.likes),s>-1&&"twitter"!==k.type&&(r+='<a href="'+k.permalink+'" class="ff-likes"><i class="ff-icon-like"></i> <span>'+(0>s?"":c(s,2))+"</span></a>"),u=parseInt(k.additional.shares),u>-1&&(r+='<a href="'+("twitter"===k.type?"https://twitter.com/intent/retweet?tweet_id="+k.id:k.permalink)+'" class="ff-shares"><i class="ff-icon-shares"></i> <span>'+(0>u?"":c(u,2))+"</span></a>"),s>-1&&"twitter"===k.type&&(r+='<a href="https://twitter.com/intent/favorite?tweet_id='+k.id+'" class="ff-likes"><i class="ff-icon-like"></i> <span>'+(0>s?"":c(s,2))+"</span></a>"),t=parseInt(k.additional.comments),"twitter"!==k.type&&t>-1&&(r+='<a href="'+k.permalink+'" class="ff-comments"><i class="ff-icon-comment"></i> <span>'+(t>-1?c(t,2):"")+"</span></a>")),d&&(o=encodeURIComponent(k.permalink),G+='<div class="ff-share-wrapper"><i class="ff-icon-share"></i><div class="ff-share-popup"><a href="http://www.facebook.com/sharer.php?u='+o+'" class="ff-fb-share"><span>Facebook</span></a><a href="https://twitter.com/share?'+(k.header?"text="+encodeURIComponent(k.header)+"&":"")+"url="+o+'" class="ff-tw-share"><span>Twitter</span></a><a href="https://plus.google.com/share?url='+o+'" class="ff-gp-share"><span>Google+</span></a><a href="https://www.pinterest.com/pin/create/button/?url='+o+(k.media?"&media="+encodeURIComponent(k.media.url):"")+'" class="ff-pin-share"><span>Pinterest</span></a></div></div>'),A=k.media?' data-media="'+k.media.width+";"+k.media.height+";"+("yep"===n.forceHTTPS?k.media.url.replace("http:","https:"):k.media.url)+";"+k.media.type+(k.img?";"+k.img.width+";"+k.img.height:"")+'"':"",w.image=k.img?'<span class="ff-img-holder ff-img-loading" '+A+'><img class="ff-initial-image" src="'+("yep"===n.forceHTTPS?k.img.url.replace("http:","https:"):k.img.url)+'" data-size="'+k.img.width+";"+k.img.height+'" /></span>':"",w.header=k.header?'<h4><a rel="nofollow" href="'+p+'">'+k.header+"</a></h4>":"",w.text='<div class="ff-content">'+k.text+"</div>",w.meta='<div class="ff-item-meta"><span class="ff-userpic" style="background:url('+("yep"===n.forceHTTPS?k.userpic.replace("http:","https:"):k.userpic)+')"><i class="ff-icon"><i class="ff-icon-inner"></i></i></span><h6><a rel="nofollow" href="'+k.userlink+'" class="ff-name '+(k.userlink?"":" ff-no-link")+'">'+k.screenname+"</a></h6>"+(k.nickname?'<a rel="nofollow" href="'+k.userlink+'" class="ff-nickname'+(k.userlink?"":" ff-no-link")+'">'+k.nickname+"</a>":"")+'<a rel="nofollow" href="'+k.permalink+'" class="ff-timestamp">'+D(k.system_timestamp,k.timestamp)+"</a></div>",w.labelIcon=H?"":'<h6 class="ff-label-wrapper"><i class="ff-icon"><i class="ff-icon-inner"><span class="ff-label-text">'+k.type+"</span></i></i></h6>";for(var J=0,K=f.template.length;K>J;J++)1===J&&z&&(q+='<div class="ff-overlay-wrapper">'),q+=w[f.template[J]],"meta"===f.template[J]&&(q+=w.labelIcon),J===K-1&&z&&(q+='<h6 class="ff-item-bar">'+r+G+"</h6>",q+='<div class="ff-overlay"></div></div>');console.log("_uid item",I),E+='<article class="ff-item'+(k.media&&"image"!=k.media.type?" ff-video-preview":"")+" ff-"+k.type+("meta"===f.template[f.isOverlay?1:0]||!k.img&&"meta"===f.template[1]?" ff-meta-first":"")+(k.header?" ff-has-header":"")+(k.img?" ff-image":" ff-no-image")+(z?" ff-has-overlay":"")+'" id="ff-uid-'+I+'" post-id="'+k.id+'" data-type="'+k.type+'" data-index="'+(i+g)+'"'+A+' data-timestamp="'+k.system_timestamp+'">'+(e&&k.mod?F:"")+'<div class="picture-item__inner"><div class="ff-item-cont">'+q+"</div>"+(z?"":'<h6 class="ff-item-bar">'+r+G+"</h6>"),j&&(E+='<a class="ff-mob-link" href="'+k.permalink+'"></a>'),E+="</div></article>"}else l="yep"===k.label?'data-label="'+k.labelTxt+";"+k.labelCol+'"':"",m='style="'+(k.textCol?"color:"+k.textCol+";":"")+("js"===k.adtype?"height:"+k.height+"px":"")+'"',E+='<div class="ff-item ff-'+k.type+(k.permalink?" ff-ad-link":"")+'" id="ff-uid-'+I+'" post-id="'+k.id+'" data-type="'+k.type+'" data-adtype="'+k.adtype+'" data-index="'+i+'" '+l+'><div class="picture-item__inner" style="'+(k.cardBG?"background-color:"+k.cardBG+";":"")+'"><div class="ff-item-cont"><div class="ff-content" '+m+">"+k.text.replace(/document\.write\((.+?)\)/i,function(a,b){
return"jQuery("+b+').appendTo(jQuery("#ff-uid-'+I+' .ff-content"))'})+"</div>",k.permalink&&(E+='<a class="ff-link" href="'+k.permalink+'"></a>'),E+="</div></div></div>";I++}return E}function q(a,b,c,d,e,f){setTimeout(function(){t(a,b,c,d,e,f)},0)}function r(b,c){clearTimeout(f),m||(b.find(".ff-item").each(w),m=!0),f=setTimeout(function(){if(r.finder,b.find(".ff-highlight").each(function(){a(this).replaceWith(this.childNodes)}),c){var d="justified"!==b.data("opts").layout?"shuffleCustom":"rowGrid";b[d]("shuffle",function(b,d){var e,f;return d&&"all"!==d.group&&-1===a.inArray(d.group,b.data("groups"))?!1:(e=b.find(':contains("'+c+'")'),e.length&&e.first().find("*").filter(function(){var b=a(this);return!b.children().length||b.is("p")}).each(function(b,d){var e=a(d);e.is("p")?r.finder=window.findAndReplaceDOMText(d,{find:new RegExp(c,"i"),wrap:"span",clss:"ff-highlight"}):a(d).html(function(a,b){var d=b.replace(new RegExp(c,"i"),function(a){return'<span class="ff-highlight">'+a+"</span>"});return d})}),e.length||(f=a.trim(b.attr("data-type")).toLowerCase(),f=-1!==f.indexOf(c)),e.length||f)},"only_sort")}},100)}function s(b,c){m||(b.find(".ff-item").each(w),m=!0);var d="justified"!==b.data("opts").layout?"shuffleCustom":"rowGrid";b[d]("shuffle",function(b,d){if(d&&"all"!==d.group&&-1===a.inArray(d.group,b.data("groups")))return!1;var e=a.trim(b.attr("data-type")).toLowerCase();return c?-1!==e.indexOf(c):1},"only_sort")}function t(b,c,d,e,f,i){function j(a){function b(a,b){var c,d,e;for(c=b.length;c--;)if(e=b[c].size,e>a){d=parseInt(b[c].val);break}return console.log(a,b),d}var c=Array.prototype.slice.call(arguments);return c.push(t.spacing),b.apply(null,c)}function k(a,b){function c(a,b,c){var d,e,f,g;for(d=c.length;d--;)if(f=c[d].size,f>a){g=parseInt(c[d].val),e=(a-2*b-b*(g-1))/g;break}return e?Math.floor(e):260}var d=Array.prototype.slice.call(arguments);b||this._itemMargin;return d.push(t.columns),c.apply(null,d)}var l,m,o,q,r=(b.find(".shuffle__sizer"),b.find(".ff-item")),s="grid"===f.layout?"":"masonry"===f.layout?"m-":"j-",t={columns:[{size:1e4,val:f[s+"c-desktop"]},{size:1200,val:f[s+"c-laptop"]},{size:1024,val:f[s+"c-tablet-l"]},{size:768,val:f[s+"c-tablet-p"]},{size:480,val:f[s+"c-smart-l"]},{size:380,val:f[s+"c-smart-p"]}],spacing:[{size:1e4,val:f[s+"s-desktop"]},{size:1200,val:f[s+"s-laptop"]},{size:1024,val:f[s+"s-tablet-l"]},{size:768,val:f[s+"s-tablet-p"]},{size:480,val:f[s+"s-smart-l"]},{size:380,val:f[s+"s-smart-p"]}],row:[{size:1e4,val:f[s+"h-desktop"]},{size:1200,val:f[s+"h-laptop"]},{size:1024,val:f[s+"h-tablet-l"]},{size:768,val:f[s+"h-tablet-p"]},{size:480,val:f[s+"h-smart-l"]},{size:380,val:f[s+"h-smart-p"]}]};return v(r),"justified"!==f.layout?(b.shuffleCustom({itemSelector:".ff-item",gutterWidth:j,columnWidth:k,streamOpts:f}),b.on("done.shuffle",function(){setTimeout(function(){l.layout(),i.find(".ff-loadmore-wrapper").css("visibility","visible")},0)})):(b.rowGrid({minMargin:5,maxMargin:5,itemSelector:".ff-item",firstItemClass:"first-item",resize:!0,sizes:t,streamOpts:f}),setTimeout(function(){i.find(".ff-loadmore-wrapper").css("visibility","visible")},0)),e&&(o=b.parent(),m=new CBPGridGallery(o,{iconStyle:f["icons-style"]}),q=o.find(".ff-slideshow").attr("id",o.attr("id")+"-slideshow"),"yep"===f.hidemeta&&q.addClass("ff-hide-meta"),setTimeout(function(){document.body.appendChild(q.get(0))},0)),window.requestAnimationFrame&&(console.log("addViewportItems"),u(b,r)),b.find(".ff-item:not(.ff-ad) .ff-content").dotdotdot({ellipsis:"...",after:""}),l=b.data("shuffle"),c&&(c=parseInt(c),b.addClass("ff-slider").parent().css("paddingBottom","70px"),y(b,c,l,d),b.shuffleCustom("shuffle",function(a,b){return parseInt(a.attr("data-index"))<=c}),b.data("num",r.length),b.data("visible",0)),i.find(".ff-loadmore-wrapper span").click(function(){var c=a(this),d=i.find(".ff-loader"),e=i.find(".ff-item").not(".ff-ad").length,j={action:"fetch_posts","stream-id":f.id,page:f["next-page"],countOfPages:f.countOfPages,hash:f.hash};c.css("opacity",0),d.insertAfter(c).show().removeClass("ff-squeezed"),a.get(FlowFlowOpts.ajaxurl,j,function(i){var j=JSON.parse(i),k=j.items,o=(k.length,a('[id^="ff-uid-"]').length+1||1),q=p(k,o,!0,n.moderation,f),r=a(q),s=r.not(".ff-ad"),t=s.toArray();if(b.trigger("loaded_more",{items:r}),f.hash=j.hash,f["next-page"]=j.page+1,f.countOfPages=j.countOfPages,b.append(r),"justified"!==f.layout?b.shuffleCustom("appended",r):b.rowGrid("appended"),v(r),window.requestAnimationFrame&&u(b,r),s.each(function(){a(this).find("img").not(":first").remove()}),r.find("img").each(function(){h.apply(this,[b])}),m&&(m._addSlideShowItems(t),m.initItemsEvents(t,e),m.slideshowItems=[].slice.call(m.slideshow.children),m.itemsCount=m.itemsCount+s.length),"yep"===n.open_in_new){var w=location.hostname;r.find("a").filter(function(){return this.hostname!=w}).attr("target","_blank")}if(g(s,f),d.addClass("ff-squeezed").delay(300).hide(),setTimeout(function(){s.filter(":lt(5)").addClass("in"),s.find(".ff-content").dotdotdot({ellipsis:"...",after:""}),setTimeout(function(){j.page+1!=j.countOfPages?c.css("opacity",1):c.remove(),l.layout()},200)},14),FlowFlowOpts.dependencies.ads&&j.ads){var x=jQuery.post(n.ajaxurl,{action:"flow_flow_ad_action",status:"view",id:j.ads});a.when(x).always(function(a){})}})}),l}function u(a,b){b.each(function(){FF_Viewport.add({element:this,threshold:130,enter:w,leave:x})})}function v(a){a.find(".picture-item__inner").addClass("picture-item__inner--transition")}function w(){a(this).addClass("in").data("viewport","in")}function x(){a(this).data("viewport","out")}function y(b,c,d,e){function f(){var a=k.data("currentSlide"),b=a-1;1>b&&(b=n),k.data("currentSlide",b),h(b),e&&setTimeout(i,0)}function g(){var a=k.data("currentSlide"),b=a+1;b>n&&(b=1),k.data("currentSlide",b),h(b),e&&setTimeout(i,0)}function h(d){b.shuffleCustom("shuffle",function(b,e){var f,g,h;return"all"!==e.group&&-1===a.inArray(e.group,b.data("groups"))?!1:(f=b.attr("data-index"),g=c*(d-1),h=c*d,f>g&&h>=f)})}function i(){var c=b.offset().top;a("html, body").animate({scrollTop:c-100},300)}var k,l=a('<span class="ff-control-prev"/>'),m=a('<span class="ff-control-next"/>'),n=Math.ceil(d.$items.length/c);l.on("click",f),m.on("click",g),j&&A(b,f,g),k=a('<div class="ff-controls-wrapper"></div>').append(l).append(m),k.data("currentSlide",1),b.on("layout.shuffle",function(){}),b.append(k)}function z(b,c){b.find("img").each(function(){var b=a(this),d=parseInt(b.css("height")),e=parseInt(b.css("width")),f=c/e;b.css("height",Math.round(d*f)+"px")})}function A(a,b,c){var d,e,f,g,h;a.bind("touchstart",function(a){f=(new Date).getTime(),d=a.originalEvent.touches[0].pageX,e=a.originalEvent.touches[0].clientY}).bind("touchmove",function(a){g=a.originalEvent.touches[0].pageX,h=a.originalEvent.touches[0].clientY}).bind("touchend",function(){var a=g>d?"right":"left",i=h-e>60||-60>h-e,j=g-d>60||-60>g-d,k=(new Date).getTime();if(!(k-f>300||i)&&j)switch(a){case"left":c();break;case"right":b()}})}function B(b,c,d){var e=d.id,f=d.hash,g={};b.find(".ff-moderation-apply").click(function(b){var c=a.post(FlowFlowOpts.ajaxurl,{action:"moderation_apply_action",moderation_action:"custom_approve",stream:e,changed:g,hash:f});a.when(c).done(function(a){location.reload()})}),b.find(".ff-moderation-approve-new").click(function(b){var c=a.post(FlowFlowOpts.ajaxurl,{action:"moderation_apply_action",moderation_action:"new_posts_approve",stream:e,hash:f});a.when(c).done(function(a){location.reload()})}),b.on("change",".ff-moderation-wrapper input",function(b){var c=a(this),d=c.is(":checked"),e=c.closest(".ff-item").attr("post-id");c.closest(".ff-moderation-wrapper")[d?"addClass":"removeClass"]("ff-approved"),g[e]={approved:d}})}function C(a){for(var b,c,d=a.length;0!==d;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a}var D="agoStyleDate"===n.date_style?function(a,b){return k(a,b)}:function(a,b){return b},E=[1,60,3600,86400,604800,2630880,31570560,315705600],F=n.dates.months,G=[n.dates.s,n.dates.m,n.dates.h],H=(FF_Viewport.getInstance(),{});return{init:d,streams:H,addTransitionToItems:v,addViewportItems:u,prepareImageFor:h,adjustItems:g,shuffle:t,recalcLayout:i,buildItems:p,buildStreamWith:e,setupGrid:q,adjustImgHeight:z}}(a);window.FlowFlow=o.init()}(jQuery),jQuery(document).on("done.shuffle",function(a,b){jQuery(function(){setTimeout(function(){},500)})});